import{l as s,s as a,r as t,k as e,m as o,p as l,o as i,c as n,w as r,e as c,a as d,b as u,q as f,u as g,t as h,j as p,v,i as _,d as m,f as b}from"./index-95803fb6.js";import{_ as y,a as L,b as k,u as w,z as x,G as I,c as F,R as C,f as M}from"./date-format.23814063.js";import{g as G,b as R,c as j,P as S,_ as Y,o as A,d as B,e as P,f as z,h as D,i as q,s as E}from"./uni-popup.f6ae92fa.js";const H=s("staff-buy",{state:()=>({activitiesInfo:{},categoryList:[],goodsList:[],pageIndex:0,loadMoreState:"loading"}),actions:{async getActivitiesInfo(){this.activitiesInfo=await G(),this.categoryList=await R(),this.pageIndex=1,await this.getGoodsList(0)},async getGoodsList(s,a){var t;a&&(this.pageIndex=1);const e=this.activitiesInfo.id,o=this.categoryList[s].cate_id,l=await j(e,o,this.pageIndex);a&&(this.goodsList.length=0),null==(t=this.goodsList)||t.push(...l.data),0===l.data.length||l.data.length<S?this.loadMoreState="noMore":l.data.length===S&&(this.loadMoreState="loading"),this.pageIndex+=1},destroy(){this.pageIndex=0,this.goodsList.length=0}}}),T=Y({__name:"staff-buy-page",setup(s){const G=H(),{activitiesInfo:R,goodsList:j,loadMoreState:S}=a(G),Y=t(),T=t(),U=t(),$=t(),J=t(""),K=t(0),N=t(!1);let O=0;const Q=()=>{v()},V=()=>{Y.value.showPop()},W=()=>{E("我的订单")},X=()=>{E("购物车")},Z=e((()=>{var s;return null==(s=G.categoryList)?void 0:s.map((s=>s.cate_name))}));o(R,(s=>{switch(R.value.status){case 1:J.value="距离本期特定折扣购买截止:",N.value=!0;break;case 2:J.value="本期特定折扣已截止，请耐心等待下期哦～",N.value=!1;break;case 3:J.value=`下期特定折扣购买于${M(R.value.next_start_at,"YYYY-MM-DD hh:mm")}开始`,N.value=!1}})),A((()=>{console.log("onLoad"),G.getActivitiesInfo()}));const ss=(s,a)=>{O=s,G.getGoodsList(s,!0).then((()=>{}))};return B((s=>{})),P((()=>{console.log("onReachBottom: "),G.getGoodsList(O,!1)})),z((()=>{G.getGoodsList(O,!0).finally((()=>{l()}))})),D((()=>{console.log("onUnload"),G.destroy()})),q((()=>{console.log("onHide")})),(s,a)=>{const t=_,e=m,o=c,l=b;return i(),n(o,{class:"staff-buy-container"},{default:r((()=>{var s;return[d(o,{class:"toolbar"},{default:r((()=>[d(t,{class:"back-btn",src:y,mode:"aspectFit",onClick:Q}),d(o,{class:"right"},{default:r((()=>[d(t,{class:"search",src:L}),d(e,null,{default:r((()=>[u("搜索")])),_:1})])),_:1})])),_:1}),d(o,{ref_key:"scrollRef",ref:$,class:"scroll-view"},{default:r((()=>[d(o,{class:"header-wrapper",ref_key:"headRef",ref:U},{default:r((()=>[d(t,{class:"rule",src:k,onClick:V}),d(o,{class:"countdown-wrapper"},{default:r((()=>{var s;return[d(e,{class:f(["text",{"end-status-text":1!==g(R).status}])},{default:r((()=>[u(h(J.value)+"  ",1)])),_:1},8,["class"]),N.value?(i(),n(w,{key:0,timestamp:null==(s=g(R))?void 0:s.end_at,"show-colon":!1,"splitor-color":"#7749BC","background-color":"#764ABC",color:"#FFFFFF"},null,8,["timestamp"])):p("v-if",!0)]})),_:1})])),_:1},512),d(o,{class:"tab-wrapper"},{default:r((()=>[d(x,{ref_key:"tabRef",ref:T,class:"tab",list:g(Z),current:K.value,"bg-color":"#fff","active-color":"#FE395F","inactive-color":"#212121","bar-width":"16px",onChange:ss},null,8,["list","current"])])),_:1}),d(I,{"goods-list":g(j)},null,8,["goods-list"]),d(F,{"icon-size":20,iconType:"circle",status:g(S),"content-text":{contentnomore:"-- 没有更多了 --"}},null,8,["status"]),d(o,{class:"shopping-cart",onClick:X},{default:r((()=>[d(l,{class:"btn"},{default:r((()=>[u("查看购物清单")])),_:1})])),_:1})])),_:1},512),d(o,{class:"order-list",onClick:W},{default:r((()=>[u("我的订单")])),_:1}),d(C,{ref_key:"rulePopRef",ref:Y,rules:null==(s=g(R))?void 0:s.rules},null,8,["rules"])]})),_:1})}}},[["__scopeId","data-v-282eed1e"]]);export{T as default};
